<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>é‹å‹•å³¶ï½œå¾Œå°ç®¡ç†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CDNï¼ˆå¾Œå°å¯æ¥å—ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --line-green: #06C755;
    }
    body {
      font-family: "Noto Sans TC", system-ui, sans-serif;
      background: #f5f6f7;
    }
  </style>
</head>

<body class="min-h-screen">

  <!-- Header -->
  <header class="bg-white border-b sticky top-0 z-10">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-xl font-black text-slate-800">
        ğŸ›  é‹å‹•å³¶ å¾Œå°ç®¡ç†
      </h1>
      <span class="text-sm font-bold text-green-600">
        LINE OA ç®¡ç†ä»‹é¢
      </span>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="bg-white border-b">
    <div class="max-w-6xl mx-auto px-6 flex space-x-6">
      <button class="tab-btn text-green-600 font-black border-b-4 border-green-500 py-3"
              onclick="showTab('course')">èª²ç¨‹ç®¡ç†</button>
      <button class="tab-btn text-slate-500 font-bold py-3"
              onclick="showTab('payment')">é‡‘æµç®¡ç†</button>
    </div>
  </nav>

  <!-- Content -->
  <main class="max-w-6xl mx-auto px-6 py-8 space-y-12">

    <!-- èª²ç¨‹ç®¡ç† -->
    <section id="tab-course">
      <h2 class="text-lg font-black mb-4">ğŸ“š èª²ç¨‹åˆ—è¡¨</h2>

      <div class="bg-white rounded-xl border overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-green-50 text-green-700 font-bold">
            <tr>
              <th class="p-3 text-left">èª²ç¨‹</th>
              <th class="p-3">æ¢¯æ¬¡</th>
              <th class="p-3">æœŸé–“</th>
              <th class="p-3">ç‹€æ…‹</th>
            </tr>
          </thead>
          <tbody id="courseTable"></tbody>
        </table>
      </div>
    </section>

    <!-- é‡‘æµç®¡ç† -->
    <section id="tab-payment" class="hidden">
      <h2 class="text-lg font-black mb-4">ğŸ’° é‡‘æµç®¡ç†</h2>

      <div class="bg-white rounded-xl border overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-green-50 text-green-700 font-bold">
            <tr>
              <th class="p-3">å­¸å“¡</th>
              <th class="p-3">èª²ç¨‹</th>
              <th class="p-3">æ‡‰ä»˜</th>
              <th class="p-3">å¯¦ä»˜</th>
              <th class="p-3">ç‹€æ…‹</th>
              <th class="p-3">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="paymentTable"></tbody>
        </table>
      </div>
    </section>

  </main>

<script>
const API_URL = window.location.href.split('?')[0];

/* =============================
 * Tabs
 * ============================= */
function showTab(tab) {
  document.getElementById('tab-course').classList.toggle('hidden', tab !== 'course');
  document.getElementById('tab-payment').classList.toggle('hidden', tab !== 'payment');

  document.querySelectorAll('.tab-btn').forEach(b => {
    b.classList.remove('text-green-600','border-green-500','border-b-4','font-black');
    b.classList.add('text-slate-500','font-bold');
  });

  event.target.classList.add('text-green-600','border-green-500','border-b-4','font-black');
}

/* =============================
 * Load Courses
 * ============================= */
async function loadCourses() {
  const res = await post({ action: 'adminGetData' });
  const list = res.èª²ç¨‹ || [];

  document.getElementById('courseTable').innerHTML = list.map(c => `
    <tr class="border-t">
      <td class="p-3 font-bold">${c.name}</td>
      <td class="p-3 text-center">${c.batch || '-'}</td>
      <td class="p-3 text-center">${c.start || ''} ~ ${c.end || ''}</td>
      <td class="p-3 text-center text-green-600 font-bold">${c.status}</td>
    </tr>
  `).join('');
}

/* =============================
 * Load Payments
 * ============================= */
async function loadPayments() {
  const res = await post({ action: 'adminGetPayments' });
  const list = res.data || [];

  document.getElementById('paymentTable').innerHTML = list.map(p => `
    <tr class="border-t">
      <td class="p-3 font-bold">${p.student}</td>
      <td class="p-3">${p.course}</td>
      <td class="p-3 text-right text-red-600 font-bold">$${p.payable}</td>
      <td class="p-3">
        <input type="number" class="w-24 border rounded px-2 py-1"
               value="${p.paid}"
               onchange="updatePayment(${p.row}, this.value, '${p.status}')">
      </td>
      <td class="p-3 text-center font-bold">${p.status}</td>
      <td class="p-3 text-center">
        <button class="bg-green-500 text-white px-3 py-1 rounded"
                onclick="updatePayment(${p.row}, ${p.payable}, 'PAID')">
          æ¨™è¨˜å·²ä»˜
        </button>
      </td>
    </tr>
  `).join('');
}

/* =============================
 * Update Payment
 * ============================= */
async function updatePayment(row, paid, status) {
  await post({
    action: 'adminUpdatePayment',
    row,
    paid,
    status
  });
  loadPayments();
}

/* =============================
 * POST helper
 * ============================= */
async function post(payload) {
  const res = await fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  });
  return await res.json();
}

/* Init */
loadCourses();
loadPayments();
</script>

</body>
</html>
