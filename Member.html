<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>運動島｜課程報名</title>

  <!-- Tailwind（維持你現況） -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- LIFF -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body { background:#F4F5F7; }
    .nav-active { color:#06C755; font-weight:700; }
    .calendar-cell { border:1px solid #E5E7EB; }
    .cell-full { background:#DCFCE7; color:#166534; }
    .cell-am { background:#FEF3C7; color:#92400E; }
    .cell-pm { background:#DBEAFE; color:#1E40AF; }
  </style>
</head>

<body class="max-w-md mx-auto bg-white min-h-screen relative">

<!-- ================= HEADER ================= -->
<header class="p-4 border-b flex items-center gap-3">
  <img src="https://aiwe.cc/wp-content/uploads/2025/12/3486bc19dc6317e16bf4f1449ec52ae4.jpg"
       class="h-8 rounded"/>
  <h1 class="font-black text-lg">運動島課程報名</h1>
</header>

<!-- ================= MAIN ================= -->
<main id="view-course" class="p-4 space-y-4">
  <div id="courseList" class="space-y-3"></div>
</main>

<!-- ================= NAV ================= -->
<nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around py-2 text-xs">
  <button onclick="showCourse()" class="nav-active">課程</button>
  <button onclick="showMember()">會員</button>
</nav>

<!-- ================= CALENDAR MODAL ================= -->
<div id="calendarModal"
     class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
  <div class="bg-white w-[92%] rounded-xl p-4 max-h-[90vh] overflow-y-auto">
    <h3 class="font-black text-lg mb-2">選擇不出席時段</h3>
    <p class="text-xs text-blue-600 mb-3">
      點擊日期切換：全日 → 上午 → 下午 → 出席
    </p>

    <div id="calendarGrid"
         class="grid grid-cols-7 gap-1 text-xs mb-4"></div>

    <div class="flex gap-2">
      <button onclick="closeCalendar()"
              class="flex-1 border rounded py-2">取消</button>
      <button onclick="confirmCalendar()"
              class="flex-1 bg-[#06C755] text-white rounded py-2 font-bold">
        確認
      </button>
    </div>
  </div>
</div>

<script>
/* =====================================================
 * 基本設定
 * ===================================================== */
const API_URL = "https://sport.wetw-net3.workers.dev/";
let activeCourse = null;
let calendarData = [];

/* =====================================================
 * 初始化
 * ===================================================== */
async function init() {
  await liff.init({ liffId: "2008792551-CzPJtVB1" });
  if (!liff.isLoggedIn()) return liff.login();
  loadCourses();
}

/* =====================================================
 * 課程列表
 * ===================================================== */
async function loadCourses() {
  const res = await fetch(API_URL, {
    method:'POST',
    body:JSON.stringify({ action:'getCourses' })
  }).then(r=>r.json());

  document.getElementById('courseList').innerHTML =
    res.data.map((c,i)=>`
      <div class="border rounded p-3">
        <div class="font-bold">${c.名稱}</div>
        <div class="text-xs text-gray-500">${c.開始} ～ ${c.結束}</div>
        <button class="mt-2 bg-[#06C755] text-white px-3 py-1 rounded"
                onclick="openCalendar(${i})">
          報名
        </button>
      </div>
    `).join('');
}

/* =====================================================
 * 日曆邏輯
 * ===================================================== */
function openCalendar(index) {
  activeCourse = index;
  calendarData = generateCalendar();
  renderCalendar();
  document.getElementById('calendarModal').classList.remove('hidden');
  document.getElementById('calendarModal').classList.add('flex');
}

function closeCalendar() {
  document.getElementById('calendarModal').classList.add('hidden');
}

function generateCalendar() {
  const days = 7; // demo：7天
  const arr = [];
  for (let i=0;i<days;i++){
    arr.push({ date:`Day ${i+1}`, period:"NONE" });
  }
  return arr;
}

function togglePeriod(i) {
  const order = ["NONE","FULL","AM","PM"];
  const idx = order.indexOf(calendarData[i].period);
  calendarData[i].period = order[(idx+1)%order.length];
  renderCalendar();
}

function renderCalendar() {
  document.getElementById('calendarGrid').innerHTML =
    calendarData.map((d,i)=>{
      let cls="calendar-cell";
      if(d.period==="FULL") cls+=" cell-full";
      if(d.period==="AM") cls+=" cell-am";
      if(d.period==="PM") cls+=" cell-pm";
      return `
        <div class="p-2 text-center cursor-pointer ${cls}"
             onclick="togglePeriod(${i})">
          <div>${d.date}</div>
          <div class="font-bold text-xs">${d.period}</div>
        </div>
      `;
    }).join('');
}

function confirmCalendar() {
  console.log("選擇結果", calendarData);
  alert("日曆選擇完成（尚未扣款）");
  closeCalendar();
}

/* =====================================================
 * 導覽
 * ===================================================== */
function showCourse(){}

function showMember(){
  alert("會員區尚未在 Step 3 啟用");
}

window.onload = init;
</script>
</body>
</html>
