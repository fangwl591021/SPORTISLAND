<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>運動島會員</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>

<body class="bg-slate-100">

<!-- BANNER -->
<div class="bg-[#06C755] text-white text-center py-4 font-black text-xl">
  運動島 Sports Island
</div>

<!-- 會員列表 -->
<div id="view-member" class="p-4">
  <div class="flex justify-between items-center mb-3">
    <h2 class="font-black text-lg">會員名冊</h2>
    <button onclick="openAdd()" class="text-[#06C755] font-bold">＋ 新增家人</button>
  </div>
  <div id="familyList" class="space-y-3"></div>
</div>

<!-- 新增家人 -->
<div id="view-add" class="hidden p-4">
  <h2 class="font-black text-lg mb-3">新增家人</h2>

  <input id="aName" class="w-full p-3 border rounded mb-2" placeholder="姓名">
  <input id="aPhone" class="w-full p-3 border rounded mb-2" placeholder="電話">

  <select id="aGender" class="w-full p-3 border rounded mb-2">
    <option value="">性別</option>
    <option>男</option>
    <option>女</option>
  </select>

  <input id="aBirthday" type="date" class="w-full p-3 border rounded mb-2">

  <select id="aAddress" class="w-full p-3 border rounded mb-2">
    <option>台北市</option><option>新北市</option><option>桃園市</option>
    <option>台中市</option><option>台南市</option><option>高雄市</option>
  </select>

  <select id="aRelation" class="w-full p-3 border rounded mb-4">
    <option>子女</option>
    <option>配偶</option>
    <option>家人</option>
  </select>

  <div class="flex gap-3">
    <button onclick="saveAdd()" class="flex-1 bg-[#06C755] text-white py-3 rounded font-bold">
      儲存
    </button>
    <button onclick="cancelAdd()" class="flex-1 border border-[#06C755] text-[#06C755] py-3 rounded font-bold">
      取消
    </button>
  </div>
</div>

<script>
const API = "https://sport.wetw-net3.workers.dev/";
let uid = "";

async function init(){
  await liff.init({ liffId:"2008792551-CzPJtVB1" });
  if(!liff.isLoggedIn()) return liff.login();
  uid = (await liff.getProfile()).userId;
  loadFamily();
}

async function loadFamily(){
  const res = await fetch(API,{
    method:'POST',
    body:JSON.stringify({action:'getFamily', userId:uid})
  }).then(r=>r.json());

  familyList.innerHTML = res.data.map(m=>`
    <div class="bg-white p-3 rounded">${m.name}（${m.relation}）</div>
  `).join('');
}

function openAdd(){
  view('add');
}

function cancelAdd(){
  view('member');
}

async function saveAdd(){
  await fetch(API,{
    method:'POST',
    body:JSON.stringify({
      action:'addFamily',
      userId:uid,
      name:aName.value,
      phone:aPhone.value,
      gender:aGender.value,
      birthday:aBirthday.value,
      address:aAddress.value,
      relation:aRelation.value
    })
  });
  view('member');
  loadFamily();
}

function view(v){
  viewMember.classList.toggle('hidden', v!=='member');
  viewAdd.classList.toggle('hidden', v!=='add');
}

window.onload = init;
</script>
</body>
</html>
